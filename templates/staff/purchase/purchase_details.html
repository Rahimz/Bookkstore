{% extends "_base.html" %}

{% load i18n %}

{% load static %}

{% load humanize %}

{% load crispy_forms_tags %}

{% block title %}{% trans 'Purchase details' %}{% endblock %}

{% block content %}
<div class="container-fluid overflow-hidden">
  <div class="row">
    <div class="col-md-2">
      {% include "staff/sidebar_staff.html" with barName="purchase" %}
    </div>
    <div class="col-md-10">
      <h2>{% trans 'Purchase' %} {{ purchase.id }} - {{ purchase.vendor }}</h2>
      <div class="">
        {% include 'staff/purchase/_purchase_details_block.html' %}
      </div>
      {% if purchase.status == "draft" %}
      <div class="">
        <a href="{% url 'orders:purchase_update' purchase.id %}" class="btn btn-outline-secondary ">{% trans 'Edit purchase' %}</a>
      </div>
      <div class="my-3">
        <form class="" action="." method="post">
          {% csrf_token %}
          {{ search_form | crispy }}
          <input type="submit" class="btn btn-outline-secondary my-3" name="" value="{% trans 'Submit' %}">
        </form>

      </div>
      {% if results %}
      <div class="row">

        {% for result in results %}
        <div class="col-md-4 my-4">

          <a href="{% url 'orders:purchase_add_line' purchase_id=purchase.id product_id=result.id %}" class="btn btn-sm btn-success m-1 fs-10 text-right">
            {{ result.name | truncatechars:30 }} - {{ result.publisher | truncatechars:15 }} - {{ result.size }} - {{ result.cover_type }} - {% trans 'Quantity' %} {{ result.stock}} - {{ result.price | intcomma:False }}
          </a>
          {% if result.has_other_prices %}
          {% if result.stock_1 %}
          <a href="{% if order %}{% url 'staff:invoice_add_book_v' order_id=order.id book_id=result.id variation='v1' %}{% else %}{% url 'staff:invoice_new_add_book_v' book_id=result.id variation='v1' %}{% endif %}"
            class="btn btn-sm btn-success">{{ result.price_1 | intcomma:False }}</a>
          {% endif %}
          {% if result.stock_used %}
          <a href="{% if order %}{% url 'staff:invoice_add_book_v' order_id=order.id book_id=result.id variation='used' %}{% else %}{% url 'staff:invoice_new_add_book_v' book_id=result.id variation='used' %}{% endif %}"
            class="btn btn-sm btn-warning">{{ result.price_used | intcomma:False }}</a>
          {% endif %}
          {% endif %}
          <a href="#" class="btn btn-sm btn-success m-1 fs-10 text-right">+</a>
        </div>
        {% endfor %}

      </div>
      {% endif %} {# end of results block #}
      {% endif %} {# end of draft purchase block #}

      <div class="">
        {% include 'staff/purchase/_purchase_list_block.html' %}
      </div>
      <div class="">
        {% if purchase.status == "draft" %}
        <a href="{% url 'orders:purchase_checkout' purchase.id %}" class="btn btn-outline-success">{% trans 'Purchase checkout' %}</a>
        {% endif %}
      </div>
    </div> <!-- end of col-md-10 -->

  </div> <!-- end of main row -->
</div>
{% endblock %}
